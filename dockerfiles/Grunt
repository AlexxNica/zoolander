FROM envygeeks/alpine
MAINTAINER "Brady Vitrano <brady.vitrano@rackspace.com>"
COPY copy/ /
RUN apk --update add build-base nasm autoconf libtool automake \
                     ruby ruby-dev ruby-io-console ruby-irb ruby-json ruby-rake ruby-rdoc \
                     nodejs \
                     python \
                     readline readline-dev libxml2 libxml2-dev libxslt  \
                     libxslt-dev python zlib zlib-dev \
                     libffi libffi-dev \
                     git \
                     && \

    mkdir -p /home/bob && \
    addgroup -Sg 1000 bob &&  \
    adduser  -SG bob -u 1000 -h /home/bob bob && \
    chown bob:bob /home/bob && \

    cd ~ && \
    yes | gem update --system --no-document -- --use-system-libraries && \
    yes | gem update --no-document -- --use-system-libraries && \

    cd /home/bob && \
    gem install sass --no-document && \

    npm install -g bower grunt-cli && \
    echo '{ "allow_root": true }' > /root/.bowerrc && \
    gem clean && \
    apk del ruby-rdoc ruby-dev && \

    mkdir -p /src/app && \
    chown bob:bob /src/app && \
    echo 'bob ALL=NOPASSWD:ALL' >> /etc/sudoers && \
    rm -rf /usr/lib/ruby/gems/*/cache/*.gem && \
    rm -rf /var/cache/apk/* && \
    docker-helper cleanup

WORKDIR /src/app